apiVersion: v1
kind: Namespace
metadata:
  labels:
    app.kubernetes.io/managed-by: kustomize
    app.kubernetes.io/name: serverless-kube-watch-trigger
    control-plane: controller-manager
  name: serverless-kube-watch-trigger-system
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.18.0
  name: httptriggers.triggers.harikube.info
spec:
  group: triggers.harikube.info
  names:
    kind: HTTPTrigger
    listKind: HTTPTriggerList
    plural: httptriggers
    singular: httptrigger
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - jsonPath: .status.errorReason
      name: ErrorReason
      type: string
    - jsonPath: .status.lastRevision
      name: LastRevision
      type: string
    name: v1
    schema:
      openAPIV3Schema:
        description: HTTPTrigger is the Schema for the HTTPtriggers API.
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: HTTPTriggerSpec defines the desired state of HTTPTrigger.
            properties:
              auth:
                description: Auth represents different authentication methods.
                properties:
                  basicAuth:
                    description: BasicAuth represents the basic authentication details.
                    properties:
                      secretKeyRef:
                        description: SecretKeyRef represents the password secret reference.
                        properties:
                          key:
                            description: The key of the secret to select from.  Must
                              be a valid secret key.
                            type: string
                          name:
                            default: ""
                            description: |-
                              Name of the referent.
                              This field is effectively required, but due to backwards compatibility is
                              allowed to be empty. Instances of this type with an empty value here are
                              almost certainly wrong.
                              More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#names
                            type: string
                          optional:
                            description: Specify whether the Secret or its key must
                              be defined
                            type: boolean
                        required:
                        - key
                        type: object
                        x-kubernetes-map-type: atomic
                      user:
                        description: User represents the name of the user.
                        type: string
                    required:
                    - secretKeyRef
                    - user
                    type: object
                  tls:
                    description: TLS represents TLS authentication details.
                    properties:
                      caRef:
                        description: CARef represents the CA secret reference.
                        properties:
                          key:
                            description: The key of the secret to select from.  Must
                              be a valid secret key.
                            type: string
                          name:
                            default: ""
                            description: |-
                              Name of the referent.
                              This field is effectively required, but due to backwards compatibility is
                              allowed to be empty. Instances of this type with an empty value here are
                              almost certainly wrong.
                              More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#names
                            type: string
                          optional:
                            description: Specify whether the Secret or its key must
                              be defined
                            type: boolean
                        required:
                        - key
                        type: object
                        x-kubernetes-map-type: atomic
                      certRef:
                        description: CertRef represents the certification secret reference.
                        properties:
                          key:
                            description: The key of the secret to select from.  Must
                              be a valid secret key.
                            type: string
                          name:
                            default: ""
                            description: |-
                              Name of the referent.
                              This field is effectively required, but due to backwards compatibility is
                              allowed to be empty. Instances of this type with an empty value here are
                              almost certainly wrong.
                              More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#names
                            type: string
                          optional:
                            description: Specify whether the Secret or its key must
                              be defined
                            type: boolean
                        required:
                        - key
                        type: object
                        x-kubernetes-map-type: atomic
                      insecureSkipVerify:
                        description: InsecureSkipVerify represents verification of
                          insecure TLS certs.
                        type: boolean
                      keyRef:
                        description: KeyRef represents the key secret reference.
                        properties:
                          key:
                            description: The key of the secret to select from.  Must
                              be a valid secret key.
                            type: string
                          name:
                            default: ""
                            description: |-
                              Name of the referent.
                              This field is effectively required, but due to backwards compatibility is
                              allowed to be empty. Instances of this type with an empty value here are
                              almost certainly wrong.
                              More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#names
                            type: string
                          optional:
                            description: Specify whether the Secret or its key must
                              be defined
                            type: boolean
                        required:
                        - key
                        type: object
                        x-kubernetes-map-type: atomic
                    required:
                    - caRef
                    - certRef
                    - keyRef
                    type: object
                type: object
              body:
                description: Body represents the body of the request.
                properties:
                  contentType:
                    default: application/json
                    description: ContentType represents the content type of the body.
                    type: string
                  signature:
                    description: Signature represents message signature generator.
                    properties:
                      header:
                        description: Header represents the header key of the signature.
                        type: string
                      hmac:
                        description: HMAC represents HMAC message signature generator.
                        properties:
                          hashType:
                            default: SHA256
                            description: HashType represents the hash type.
                            enum:
                            - SHA256
                            - SHA512
                            type: string
                        type: object
                      keySecretRef:
                        description: KeySecretRef represents signature key secret.
                        properties:
                          key:
                            description: The key of the secret to select from.  Must
                              be a valid secret key.
                            type: string
                          name:
                            default: ""
                            description: |-
                              Name of the referent.
                              This field is effectively required, but due to backwards compatibility is
                              allowed to be empty. Instances of this type with an empty value here are
                              almost certainly wrong.
                              More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#names
                            type: string
                          optional:
                            description: Specify whether the Secret or its key must
                              be defined
                            type: boolean
                        required:
                        - key
                        type: object
                        x-kubernetes-map-type: atomic
                    required:
                    - header
                    - keySecretRef
                    type: object
                  template:
                    description: Template represents the template to generate body.
                    type: string
                type: object
              concurrency:
                default: 1
                description: Concurency represent the number of parallel triggers.
                maximum: 100
                minimum: 0
                type: integer
              delivery:
                description: Delivery represents the delivery details.
                properties:
                  retries:
                    default: 0
                    description: Retries represents the retries of the request on
                      failure.
                    maximum: 100
                    minimum: 0
                    type: integer
                  timeout:
                    default: '''10s'''
                    description: Timeout represents the timeout of the request.
                    format: duration
                    type: string
                type: object
              eventFilter:
                description: 'EventFilter represents a filter expression, follows
                  Go template syntax. Example: ne .old.status.availableReplicas .new.status.availableReplicas.'
                type: string
              eventTypes:
                default:
                - ADDED
                - MODIFIED
                - DELETED
                description: EventType represents the type of events to trigger.
                items:
                  enum:
                  - ADDED
                  - MODIFIED
                  - DELETED
                  type: string
                type: array
              fieldSelectors:
                description: FieldSelector represents list of field selectors.
                items:
                  type: string
                type: array
              headers:
                description: Headers represends extra headers of the request.
                properties:
                  fromSecretRef:
                    additionalProperties:
                      description: SecretKeySelector selects a key of a Secret.
                      properties:
                        key:
                          description: The key of the secret to select from.  Must
                            be a valid secret key.
                          type: string
                        name:
                          default: ""
                          description: |-
                            Name of the referent.
                            This field is effectively required, but due to backwards compatibility is
                            allowed to be empty. Instances of this type with an empty value here are
                            almost certainly wrong.
                            More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#names
                          type: string
                        optional:
                          description: Specify whether the Secret or its key must
                            be defined
                          type: boolean
                      required:
                      - key
                      type: object
                      x-kubernetes-map-type: atomic
                    description: FromSecret represents header from secret.
                    type: object
                  static:
                    additionalProperties:
                      type: string
                    description: Static represents static header.
                    type: object
                  template:
                    additionalProperties:
                      type: string
                    description: 'Template represents dynamic header, follows Go template
                      syntax. Example: X-Resource-Name: "{{ .metadata.name }}"'
                    type: object
                type: object
              labelSelectors:
                description: LabelSelector represents list of label selectors.
                items:
                  type: string
                type: array
              method:
                default: POST
                enum:
                - GET
                - POST
                - PUT
                - PATCH
                type: string
              namespaces:
                description: Namespaces represents the namespaces to watch.
                items:
                  type: string
                type: array
              resource:
                description: Resource represents the object kind.
                properties:
                  apiVersion:
                    description: |-
                      APIVersion defines the versioned schema of this representation of an object.
                      Servers should convert recognized schemas to the latest internal value, and
                      may reject unrecognized values.
                      More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
                    type: string
                  kind:
                    description: |-
                      Kind is a string value representing the REST resource this object represents.
                      Servers may infer this from the endpoint the client submits requests to.
                      Cannot be updated.
                      In CamelCase.
                      More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
                    type: string
                type: object
              sendInitialEvents:
                default: false
                description: SendInitialEvents represents initial object state triggers.
                type: boolean
              url:
                description: URL Represents the URL generator strategy.
                properties:
                  service:
                    description: Service represents a service based endpoint.
                    properties:
                      name:
                        default: ""
                        description: |-
                          Name of the referent.
                          This field is effectively required, but due to backwards compatibility is
                          allowed to be empty. Instances of this type with an empty value here are
                          almost certainly wrong.
                          More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#names
                        type: string
                      static:
                        description: Namespace represents the namespace of service.
                        type: string
                      uri:
                        description: URI Represents the URI generator strategy.
                        properties:
                          static:
                            description: Static represents a static endpoint.
                            type: string
                          template:
                            description: 'Template represents the URI template of
                              the endpoint, follows Go template syntax. Example: /function/foo/{{
                              .metadata.name }}.'
                            type: string
                        type: object
                    required:
                    - uri
                    type: object
                    x-kubernetes-map-type: atomic
                  static:
                    description: Static represents a static endpoint.
                    type: string
                  template:
                    description: 'Template represents the URL template of the endpoint,
                      follows Go template syntax. Example: https://gateway.example.com/function/foo/{{
                      .metadata.name }}.'
                    type: string
                type: object
            required:
            - resource
            - url
            type: object
          status:
            description: TriggerStatus defines the observed state of Trigger.
            properties:
              errorReason:
                type: string
              lastRevision:
                type: string
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
---
apiVersion: v1
kind: ServiceAccount
metadata:
  labels:
    app.kubernetes.io/managed-by: kustomize
    app.kubernetes.io/name: serverless-kube-watch-trigger
  name: serverless-kube-watch-trigger-controller-manager
  namespace: serverless-kube-watch-trigger-system
---
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  labels:
    app.kubernetes.io/managed-by: kustomize
    app.kubernetes.io/name: serverless-kube-watch-trigger
  name: serverless-kube-watch-trigger-leader-election-role
  namespace: serverless-kube-watch-trigger-system
rules:
- apiGroups:
  - ""
  resources:
  - configmaps
  verbs:
  - get
  - list
  - watch
  - create
  - update
  - patch
  - delete
- apiGroups:
  - coordination.k8s.io
  resources:
  - leases
  verbs:
  - get
  - list
  - watch
  - create
  - update
  - patch
  - delete
- apiGroups:
  - ""
  resources:
  - events
  verbs:
  - create
  - patch
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  labels:
    app.kubernetes.io/managed-by: kustomize
    app.kubernetes.io/name: serverless-kube-watch-trigger
  name: serverless-kube-watch-trigger-httptrigger-admin-role
rules:
- apiGroups:
  - triggers.harikube.info
  resources:
  - httptriggers
  verbs:
  - '*'
- apiGroups:
  - triggers.harikube.info
  resources:
  - httptriggers/status
  verbs:
  - get
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  labels:
    app.kubernetes.io/managed-by: kustomize
    app.kubernetes.io/name: serverless-kube-watch-trigger
  name: serverless-kube-watch-trigger-httptrigger-editor-role
rules:
- apiGroups:
  - triggers.harikube.info
  resources:
  - httptriggers
  verbs:
  - create
  - delete
  - get
  - list
  - patch
  - update
  - watch
- apiGroups:
  - triggers.harikube.info
  resources:
  - httptriggers/status
  verbs:
  - get
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  labels:
    app.kubernetes.io/managed-by: kustomize
    app.kubernetes.io/name: serverless-kube-watch-trigger
  name: serverless-kube-watch-trigger-httptrigger-viewer-role
rules:
- apiGroups:
  - triggers.harikube.info
  resources:
  - httptriggers
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - triggers.harikube.info
  resources:
  - httptriggers/status
  verbs:
  - get
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: serverless-kube-watch-trigger-manager-role
rules:
- apiGroups:
  - ""
  resources:
  - secrets
  verbs:
  - get
  - list
- apiGroups:
  - triggers.harikube.info
  resources:
  - httptriggers
  verbs:
  - create
  - delete
  - get
  - list
  - patch
  - update
  - watch
- apiGroups:
  - triggers.harikube.info
  resources:
  - httptriggers/finalizers
  verbs:
  - update
- apiGroups:
  - triggers.harikube.info
  resources:
  - httptriggers/status
  verbs:
  - get
  - patch
  - update
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  labels:
    app.kubernetes.io/managed-by: kustomize
    app.kubernetes.io/name: serverless-kube-watch-trigger
  name: serverless-kube-watch-trigger-leader-election-rolebinding
  namespace: serverless-kube-watch-trigger-system
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: serverless-kube-watch-trigger-leader-election-role
subjects:
- kind: ServiceAccount
  name: serverless-kube-watch-trigger-controller-manager
  namespace: serverless-kube-watch-trigger-system
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  labels:
    app.kubernetes.io/managed-by: kustomize
    app.kubernetes.io/name: serverless-kube-watch-trigger
  name: serverless-kube-watch-trigger-manager-rolebinding
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: serverless-kube-watch-trigger-manager-role
subjects:
- kind: ServiceAccount
  name: serverless-kube-watch-trigger-controller-manager
  namespace: serverless-kube-watch-trigger-system
---
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app.kubernetes.io/managed-by: kustomize
    app.kubernetes.io/name: serverless-kube-watch-trigger
    control-plane: controller-manager
  name: serverless-kube-watch-trigger-controller-manager
  namespace: serverless-kube-watch-trigger-system
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: serverless-kube-watch-trigger
      control-plane: controller-manager
  template:
    metadata:
      annotations:
        kubectl.kubernetes.io/default-container: manager
      labels:
        app.kubernetes.io/name: serverless-kube-watch-trigger
        control-plane: controller-manager
    spec:
      containers:
      - args:
        - --leader-elect
        - --health-probe-bind-address=:8081
        command:
        - /manager
        image: mhmxs/serverless-kube-watch-trigger:v0.0.1-15-dirty
        imagePullPolicy: IfNotPresent
        livenessProbe:
          httpGet:
            path: /healthz
            port: 8081
          initialDelaySeconds: 15
          periodSeconds: 20
        name: manager
        ports: []
        readinessProbe:
          httpGet:
            path: /readyz
            port: 8081
          initialDelaySeconds: 5
          periodSeconds: 10
        resources:
          limits:
            cpu: 500m
            memory: 128Mi
          requests:
            cpu: 10m
            memory: 64Mi
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            drop:
            - ALL
        volumeMounts: []
      securityContext:
        runAsNonRoot: true
        seccompProfile:
          type: RuntimeDefault
      serviceAccountName: serverless-kube-watch-trigger-controller-manager
      terminationGracePeriodSeconds: 10
      volumes: []
